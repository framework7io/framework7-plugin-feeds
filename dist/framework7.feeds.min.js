/**
 * Framework7 Plugin Feeds 2.0.0
 * Framework7 Feeds plugin brings easy RSS feeds integration into Framework7 app
 * http://framework7.io/plugins/
 *
 * Copyright 2014-2018 Vladimir Kharlampidi
 *
 * Released under the MIT License
 *
 * Released on: February 24, 2018
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Framework7Feeds=t()}(this,function(){"use strict";var e;return{name:"feeds",install:function(){var t;t=this.Class,e=function(e){function t(t,n){e.call(this,n,[t]);var r=t.utils,a=t.$,i=t.request,o=this;o.app=t;var l=r.extend({on:{}},t.params.feeds);o.params=r.extend(l,n);var s,p=a(o.params.el);if(!p.length)return o;function d(e){e.preventDefault();var t=a(this).data("index");o.open(o.data.items[t])}function c(){o.refreshFeed()}return(s=o.params.view?o.params.view:t.views.get(p))||(s=t.views.main),r.extend(o,{app:t,request:i,$el:p,el:p[0],view:s,url:o.params.url,data:{},opened:!1}),o.attachEvents=function(){o.$el.on("click","a.feeds-item-link",d),o.$el.parents(".ptr-content").on("ptr:refresh",c)},o.detachEvents=function(){o.$el.off("click","a.feeds-item-link",d),o.$el.parents(".ptr-content").off("ptr:refresh",c)},p[0].f7Feeds=o,o.init(),o}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.formatDate=function(e){var t=this;if(t.params.formatDate)return t.params.formatDate.call(t,e);var n=new Date(e);return"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[n.getMonth(n)]+" "+n.getDate(n)+", "+n.getFullYear()},t.prototype.parseData=function(e){var t=this,n=t.app.$,r=(new window.DOMParser).parseFromString(e,"text/xml"),a=n(r).find("rss > channel");if(0===a.length)return{};var i={title:a.children("title").text(),link:a.children("link").text(),description:a.children("description").text().replace("<![CDATA[","").replace("]]>",""),copyright:a.children("copyright").text(),image:{url:a.children("image").children("url").text(),title:a.children("image").children("title").text(),link:a.children("image").children("link").text(),width:a.children("image").children("width").text(),height:a.children("image").children("height").text()},items:[]};return a.find("item").each(function(e,r){var a=n(r),o={title:a.children("title").text().replace("<![CDATA[","").replace("]]>",""),link:a.children("link").text(),description:a.children("description").text().replace("<![CDATA[","").replace("]]>",""),pubDate:a.children("pubDate").text(),formattedDate:t.formatDate(a.children("pubDate").text()),guid:a.children("guid").text(),index:i.items.length};t.params.customItemFields&&t.params.customItemFields.length>0&&a.children().each(function(e,r){for(var a=0;a<t.params.customItemFields.length;a+=1){var i=t.params.customItemFields[a].split("||")[0],l=t.params.customItemFields[a].split("||")[1];r.nodeName===i&&(o[i.replace(/:/g,"")]=l?r.getAttribute(l):n(r).text().replace("<![CDATA[","").replace("]]>",""))}}),i.items.push(o)}),i},t.prototype.loadFeed=function(e){var t=this,n=t.app;t.emit("local::ajaxStart feedsAjaxStart",t),t.request.get(t.params.feedUrl,function(r){var a;t.emit("local::ajaxComplete feedsAjaxComplete",t,r),t.data=t.parseData(r),t.params.virtualList?e?t.virtualList.replaceAllItems(t.data.items):((a="true"===t.params.virtualList||!0===t.params.virtualList?{}:n.utils.extend({},t.params.virtualList)).el=t.el,a.items=t.data.items,a.renderItem=t.renderVirtualListItem,t.$el.html(""),t.virtualList=n.virtualList.create(a)):t.$el.html(t.renderList(t.data)),e&&n.ptr.done(t.$el.parents(".ptr-content"))})},t.prototype.renderVirtualListItem=function(e,t){var n=this;return n.params.renderVirtualListItem?n.params.renderVirtualListItem.call(n,e,t):('\n        <li>\n          <a href="#" class="item-link item-content feeds-item-link" data-index="'+t+'">\n            <div class="item-inner">\n              <div class="item-title">'+e.title+'</div>\n              <div class="item-after">'+e.formattedDate+"</div>\n            </div>\n          </a>\n        </li>\n      ").trim()},t.prototype.renderList=function(e){return this.params.renderList?this.params.renderList.call(this,e):("\n        <ul>\n          "+e.items.map(function(e,t){return'\n            <li>\n              <a href="#" class="item-link item-content feeds-item-link" data-index="'+t+'">\n                <div class="item-inner">\n                  <div class="item-title">'+e.title+'</div>\n                  <div class="item-after">'+e.formattedDate+"</div>\n                </div>\n              </a>\n            </li>\n          "}).join("")+"\n        </ul>\n      ").trim()},t.prototype.renderItemNavbar=function(e){var t=this;return t.params.renderItemNavbar?t.params.renderItemNavbar.call(t,e):('\n        <div class="navbar">\n          <div class="navbar-inner sliding">\n            '+("page"===t.params.openIn?'\n            <div class="left">\n              <a href="#" class="link back">\n                <i class="icon icon-back"></i>\n                <span class="ios-only">'+t.params.pageBackLinkText+"</span>\n              </a>\n            </div>\n            ":"")+'\n            <div class="title">'+e.title+"</div>\n            "+("popup"===t.params.openIn?'\n            <div class="right">\n              <a href="#" class="link popup-close" data-popup=".feeds-popup">'+t.params.popupCloseLinkText+"</a>\n            </div>\n            ":"")+"\n          </div>\n        </div>\n      ").trim()},t.prototype.renderItemPopup=function(e){return this.params.renderPopup?this.params.renderPopup.call(this,e):('\n        <div class="popup feeds-popup">\n          <div class="view view-init">\n            '+this.renderItemPage(e)+"\n          </div>\n        </div>\n      ").trim()},t.prototype.renderItemPage=function(e){return this.params.renderPage?this.params.renderPage.call(this,e):('\n        <div class="page feeds-page" data-page="feeds-page-'+e.index+'">\n          '+this.renderItemNavbar(e)+'\n          <div class="page-content">\n            <div class="block">\n              <a href="'+e.link+'" class="external" target="_blank">'+e.title+"</a><br>\n              <small>"+e.formattedDate+'</small>\n            </div>\n            <div class="block block-strong">'+e.description+"</div>\n          </div>\n        </div>\n      ").trim()},t.prototype.refreshFeed=function(){return this.loadFeed(!0)},t.prototype.onOpen=function(e,t){var n=this,r=n.app.$(t);n.$openedItemEl=r,n.openedItemEl=r[0],n.openedIn=e,n.opened=!0,n.emit("local::open feedsOpen",n)},t.prototype.onOpened=function(){this.emit("local::opened feedsOpened",this)},t.prototype.onClose=function(){this.destroyed||this.emit("local::close feedsClose",this)},t.prototype.onClosed=function(){var e=this;e.destroyed||(e.opened=!1,e.$openedItemEl=null,e.openedItemEl=null,delete e.$openedItemEl,delete e.openedItemEl,e.emit("local::closed feedsClosed",e))},t.prototype.openPopup=function(e){var t=this;if(t.opened)return t;var n={content:t.renderItemPopup(e),on:{popupOpen:function(e){t.onOpen("popup",e.el)},popupOpened:function(e){t.onOpened("popup",e.el)},popupClose:function(e){t.onClose("popup",e.el)},popupClosed:function(e){t.onClosed("popup",e.el)}}};return t.params.routableModals?t.view.router.navigate({url:t.url,route:{path:t.url,popup:n}}):t.modal=t.app.popup.create(n).open(),t},t.prototype.openPage=function(e){var t=this;if(t.opened)return t;var n=t.renderItemPage(e);return t.view.router.navigate({url:t.url,route:{content:n,path:t.url,on:{pageBeforeIn:function(e,n){t.onOpen("page",n.el)},pageAfterIn:function(e,n){t.onOpened("page",n.el)},pageBeforeOut:function(e,n){t.onClose("page",n.el)},pageAfterOut:function(e,n){t.onClosed("page",n.el)}}}}),t},t.prototype.open=function(e){var t=this;return t.opened?t:"popup"===t.params.openIn?t.openPopup(e):t.openPage(e)},t.prototype.close=function(){var e=this;return e.opened?(e.params.routableModals||"page"===e.openedIn?e.view.router.back():(e.modal.once("modalClosed",function(){e.app.utils.nextTick(function(){e.modal.destroy(),delete e.modal})}),e.modal.close()),e):e},t.prototype.init=function(){this.loadFeed(),this.attachEvents()},t.prototype.destroy=function(){var e=this;e.emit("local::beforeDestroy feedsBeforeDestroy",e),e.detachEvents(),e.virtualList&&e.virtualList.destroy&&e.virtualList.destroy(),delete e.$el[0].f7Feeds,e.app.utils.deleteProps(e),e.destroyed=!0},t}(t),this.Feeds=e},params:{feeds:{openIn:"page",url:"feed/",routableModals:!0,view:null,feedUrl:null,formatDate:null,customItemFields:[],virtualList:!1,pageBackLinkText:"Back",popupCloseLinkText:"Close",pageTitle:void 0,renderList:null,renderVirtualListItem:null,renderItemPage:null,renderItemPopup:null}},create:function(){var t=this;t.feeds={create:function(n){return new e(t,n)},get:function(e){var n=t.$(e);if(n.length>0&&n[0]&&n[0].f7Feeds)return n[0].f7Feeds},destroy:function(e){var n=t.$(e);n.length&&n[0]&&n[0].f7Feeds&&n[0].f7Feeds.destroy&&n[0].f7Feeds.destroy()}}},on:{pageInit:function(e){var t=e.app,n=t.$,r=t.utils;e.$el.find(".feeds-init").each(function(e,a){var i=n(a);t.feeds.create(r.extend({el:a},i.dataset()))})},pageBeforeRemove:function(e){var t=e.app;e.$el.find(".feeds-init").each(function(e,n){t.feeds.destroy(n)})}}}});
//# sourceMappingURL=framework7.feeds.min.js.map
